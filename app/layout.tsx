import "./globals.css"; // Global CSS file
import type { Metadata } from "next"; // Import Metadata type for Next.js
import Providers from "@/components/Providers"; // Import the Providers component

// Metadata configuration for the page
export const metadata: Metadata = {
  title: "Encyclochain", // Page title
  description: "Generated by create next app", // Page description
};

// Fonction pour récupérer les topics via l'API
async function fetchTopics() {
  try {
    const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/menuTopics`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
      cache: 'no-store', // Empêche la mise en cache pour les données dynamiques
    });

    if (!res.ok) {
      throw new Error(`Erreur lors de la récupération des topics : ${res.statusText}`);
    }

    return await res.json();
  } catch (error) {
    console.error("Erreur lors de la récupération des topics :", error);
    return [];
  }
}

// RootLayout en tant que composant asynchrone
export default async function RootLayout({
  children,
}: {
  children: React.ReactNode; // Expecting `children` as React nodes
}) {
  const topics = await fetchTopics(); // Fetch topics data via API

  return (
    <html lang="fr">
      <body className="h-screen flex overflow-hidden">
        <Providers topics={topics}>
          {children}
        </Providers>
      </body>
    </html>
  );
}
